# Deployment Notes - Server Action Error Fix

## Problem
Error: "Failed to find Server Action 'x'. This request might be from an older or newer deployment."

## Root Cause
This occurs when:
1. Browser has cached old client-side JavaScript chunks
2. Server is running a newer build with different action IDs
3. Multiple deployment instances running simultaneously with different builds

## Solutions Implemented

### 1. Unique Build IDs
Added `generateBuildId` to `next.config.js` to ensure each deployment has a unique build identifier, forcing cache invalidation.

### 2. Cache Control Headers
- HTML/Dynamic routes: `no-cache, no-store, must-revalidate`
- Static assets (`_next/static`): `public, max-age=31536000, immutable`

This ensures browsers always fetch fresh HTML while caching static assets properly.

## Deployment Best Practices

### For Railway/Docker Deployments:

1. **Ensure clean builds**: Docker builds are already isolated, but verify:
   - Remove any old containers: `docker system prune -a`
   - Each deployment uses the unique build ID

2. **Zero-downtime deployments**: 
   - Railway does rolling deploys by default
   - Ensure old instances are fully shut down before new ones serve traffic

3. **Clear CDN/proxy cache** (if using CloudFlare, etc.):
   ```bash
   # CloudFlare - purge all
   curl -X POST "https://api.cloudflare.com/client/v4/zones/{zone_id}/purge_cache" \
     -H "Authorization: Bearer {api_token}" \
     -d '{"purge_everything":true}'
   ```

4. **Monitor deployments**:
   - Check Railway logs for any startup errors
   - Verify build ID is unique in each deployment
   - Test immediately after deployment

### Force Browser Cache Clear (if needed)

Users experiencing this error can:
1. Hard refresh: `Cmd+Shift+R` (Mac) or `Ctrl+Shift+R` (Windows)
2. Clear site data in browser DevTools > Application > Clear Storage

## Verification

After deployment, verify the fix by:
1. Opening DevTools > Network tab
2. Check `Cache-Control` headers on HTML documents
3. Verify `_next/static/*` files have long cache times
4. Confirm no Server Action errors in console
